NOTAS DE LAN√áAMENTO ‚Äî L√∫men
Vers√£o: 2025.12.2.0
Data: 2 de dezembro de 2025
Autor: Fernando Nillsson Cidade

Resumo r√°pido
- Sistema de alarme do Pomodoro aprimorado: escolha de campainha, preview, persist√™ncia, repeti√ß√£o configur√°vel e reprodu√ß√£o robusta.
- Corre√ß√µes e melhorias na reprodu√ß√£o do alarme: repeti√ß√£o respeita a dura√ß√£o do arquivo + intervalo configurado; alarme toca imediatamente ao fim do ciclo e repete at√© o usu√°rio fechar a janela de alerta.
- Interface de configura√ß√£o de som adicionada ao menu de Configura√ß√µes com visualiza√ß√£o de dura√ß√£o e c√°lculo do tempo total entre repeti√ß√µes.
- Melhoria na confiabilidade da reprodu√ß√£o de som (recria√ß√£o do QSoundEffect) para evitar falhas ap√≥s stop/preview.

Detalhamento das mudan√ßas
- Arquivo alterado: source/utils/SoundManager.py
  - Novo gerenciador de som centralizado (singleton) que exp√µe: instance(), play(), play_repeating(), stop(), preview(), get_duration_for_path(), get_available_sounds(), get_alarm_interval(), set_alarm_interval().
  - Dete√ß√£o de dura√ß√£o de arquivos WAV via m√≥dulo wave do Python (m√©todo _get_wav_duration_ms) para obter dura√ß√£o confi√°vel em ms.
  - L√≥gica de repeti√ß√£o: play_repeating() toca o √°udio, calcula pr√≥ximo acionamento como (dura√ß√£o do √°udio) + (intervalo configurado) e agenda com QTimer.
  - Recria√ß√£o limpa do QSoundEffect em _prepare_effect() antes de cada reprodu√ß√£o para evitar comportamento onde som s√≥ toca uma vez.
  - Persist√™ncia da campainha e do intervalo em QSettings (chaves: "pomodoro/sound_path" e "pomodoro/alarm_interval").
  - M√©todos de preview e stop aprimorados; fallback de dura√ß√£o padr√£o (3000ms) quando n√£o detectada.

- Arquivo alterado: source/gui/gui_23_sound_config_dialog.py
  - Novo di√°logo "üîî Configurar Som do Pomodoro" com:
    - Combobox para sele√ß√£o de campainha (lista de WAVs em assets/sound).
    - Bot√£o ‚ñ∂Ô∏è Tocar para preview.
    - SpinBox para definir intervalo (segundos) entre repeti√ß√µes (0‚Äì60).
    - Exibi√ß√£o da dura√ß√£o do arquivo selecionado e do tempo total at√© a pr√≥xima repeti√ß√£o (dura√ß√£o + intervalo).
  - Ao salvar, grava a campainha e o intervalo nas QSettings via SoundManager.

- Arquivo alterado: source/gui/gui_03_setup_menubar.py
  - Adicionada a√ß√£o "üîî Som..." no menu "‚öôÔ∏è Configura√ß√µes" que abre o di√°logo de configura√ß√£o de som.
  - Atualiza m√≥dulos ap√≥s confirma√ß√£o do di√°logo (chamada a atualizar_modulos quando dispon√≠vel).

- Arquivo alterado: source/modules/tempo/tmp_02_PomodoroTimer.py
  - Integra√ß√£o com SoundManager.instance() para tocar alarmes ao finalizar foco/descanso.
  - M√©todo _executar_alerta exibe QMessageBox e inicia o alarme repetitivo (play_repeating) antes de mostrar a caixa; conecta fechamento da caixa para parar o alarme (stop).
  - Corre√ß√£o para que o som toque imediatamente quando o ciclo termina e continue repetindo at√© o fechamento manual da janela de alerta.
  - Logging e tratamento de exce√ß√µes adicionados.

- Arquivo alterado: source/gui/gui_08_atualizar_menu.py
  - Garantia de que a label/a√ß√£o "üîî Som..." seja atualizada quando o idioma for alterado.

Impacto e comportamento esperado
- Ao terminar um ciclo de foco ou de descanso:
  - A janela de alerta (QMessageBox) aparece imediatamente.
  - O alarme toca imediatamente e repete at√© que o usu√°rio feche a janela.
  - A repeti√ß√£o respeita a dura√ß√£o do arquivo de √°udio: pr√≥ximo toque ocorre somente ap√≥s (dura√ß√£o do √°udio) + (intervalo configurado pelo usu√°rio).
- Escolha de campainha e intervalo s√£o persistidos em configura√ß√µes locais (QSettings).
- Preview permite ouvir a campainha sem ativar repeti√ß√£o.

Como testar (passos r√°pidos)
1. Abrir Aplica√ß√£o e ir em ‚öôÔ∏è Configura√ß√µes ‚Üí üîî Som...
2. Selecionar uma campainha (WAV) e usar ‚ñ∂Ô∏è Tocar para preview.
3. Ajustar "Intervalo entre repeti√ß√µes" (ex.: 5s) e verificar o r√≥tulo "Repeti√ß√£o a cada: X.XX segundos" (dura√ß√£o do arquivo + intervalo).
4. Salvar e executar um Pomodoro curto (ou pular ciclo) at√© que finalizar_ciclo dispare.
5. Confirmar que:
   - O som toca imediatamente com a janela de alerta.
   - O som repete ap√≥s (dura√ß√£o do WAV) + (intervalo configurado).
   - Ao fechar a janela de alerta o som para imediatamente.
6. Repetir para ciclo de descanso; testar altera√ß√£o de campainha entre ciclos.

Notas t√©cnicas
- Implementa√ß√£o utiliza PySide6.QtMultimedia.QSoundEffect para reprodu√ß√£o local (compat√≠vel com WAV). Para medir dura√ß√£o de WAV, usa-se m√≥dulo padr√£o wave do Python (sem depend√™ncias externas).
- Configura√ß√µes persistidas via QSettings namespace "Lumen"/"LumenApp".
- Recomendado ter PySide6 com suporte a multimedia (FFmpeg) no ambiente.
- Caso use arquivos que n√£o sejam WAV, a fun√ß√£o de dura√ß√£o ter√° fallback (3s). Suporte a MP3/OUTROS pode exigir QMediaPlayer ou bibliotecas adicionais.

Arquivos principais alterados
- source/utils/SoundManager.py (novo / modificado)
- source/gui/gui_23_sound_config_dialog.py (novo di√°logo de configura√ß√£o)
- source/gui/gui_03_setup_menubar.py (integra√ß√£o do di√°logo no menu)
- source/modules/tempo/tmp_02_PomodoroTimer.py (integra√ß√£o e controle de alarme)
- source/gui/gui_08_atualizar_menu.py (tradu√ß√µes do menu)

Problemas conhecidos
- Dura√ß√£o exata s√≥ √© calculada para arquivos WAV via wave; outros formatos poder√£o usar fallback. Se desejar suporte completo (MP3, OGG), recomenda-se usar QMediaPlayer para extra√ß√£o de metadados ou bibliotecas externas (pydub, mutagen).
- Arquivos WAV muito grandes podem aumentar o custo de leitura; a rotina √© simples e s√≠ncrona.
- Tradu√ß√µes: strings do di√°logo e labels devem ser recompiladas em .qm (pyside6-lrelease) ap√≥s altera√ß√µes no .ts para surtir efeito.

Suporte e contato
- Autor: Fernando Nillsson Cidade
- Issues/PRs: abrir no reposit√≥rio do projeto.

_________________________________________________

NOTAS DE LAN√áAMENTO ‚Äî L√∫men
Vers√£o: 2025.11.29.0
Data: 29 de novembro de 2025
Autor: Fernando Nillsson Cidade

Resumo r√°pido
- Corre√ß√£o no comportamento do Leitor Acess√≠vel (TTS): ao clicar em "‚è∏Ô∏è Pausar" a reprodu√ß√£o agora permanece pausada e novos chunks gerados permanecem enfileirados, evitando que o leitor avance automaticamente para o pr√≥ximo chunk.

Detalhamento das mudan√ßas
- Arquivo alterado: source/modules/leitor/leitor_acessivel/lta_09_play_generated_audio.py
  - Comportamento de pausa corrigido:
    - Antes: quando o usu√°rio pausava a reprodu√ß√£o, novos arquivos de √°udio (chunks) gerados podiam iniciar automaticamente, fazendo o leitor pular a pausa.
    - Agora: a fun√ß√£o _play_generated_audio verifica explicitamente o estado do player (QMediaPlayer.PausedState) e a flag interna _is_paused. Se o player estiver pausado, novos chunks N√ÉO iniciam automaticamente ‚Äî eles s√£o apenas adicionados √† fila (_generated_queue) para reprodu√ß√£o posterior.
  - Prote√ß√µes adicionais:
    - Preserva√ß√£o de chunks durante troca de voz: se _changing_voice estiver ativo, chunks gerados s√£o descartados de forma segura (tentativa de remo√ß√£o do arquivo) e ignorados.
    - Controle de duplicatas: os caminhos dos arquivos gerados s√£o registrados em _generated_files para evitar reprocessamento duplicado.
    - Verifica√ß√£o de estado de reprodu√ß√£o: n√£o tenta iniciar novo √°udio se j√° estiver em PlayingState; respeita PausedState.
  - Robustez e logging:
    - Tratamento de exce√ß√µes expandido para evitar falhas silenciosas e garantir que leitura_finalizada() seja chamada quando apropriado.
    - Mensagens de log documentam erros ao iniciar reprodu√ß√£o de chunks e falhas na limpeza de arquivos gerados.

Impacto e comportamento esperado
- Usu√°rio pausa a narra√ß√£o com o bot√£o "‚è∏Ô∏è Pausar": playback interrompe; novos chunks gerados pelo mecanismo TTS s√£o enfileirados e N√ÉO come√ßam a tocar at√© que o usu√°rio retome manualmente (‚ñ∂Ô∏è Continuar) ou o player esteja em um estado que permita reprodu√ß√£o autom√°tica.
- Troca de voz durante gera√ß√£o: chunks criados durante a troca de voz s√£o descartados de forma segura para evitar reprodu√ß√£o com voz antiga.

Como testar (passos r√°pidos)
1. Iniciar Leitor Acess√≠vel com uma voz que use gera√ß√£o por chunks (Edge TTS ou similar).
2. Iniciar leitura.
3. Enquanto estiver reproduzindo, clicar em "‚è∏Ô∏è Pausar".
4. Confirmar que a reprodu√ß√£o para e que novos chunks gerados (por exemplo, textos longos) n√£o iniciam automaticamente.
5. Clicar em "‚ñ∂Ô∏è Continuar" e confirmar que a fila √© consumida normalmente e a reprodu√ß√£o prossegue.

Notas t√©cnicas
- A corre√ß√£o foca em _play_generated_audio e interage com QMediaPlayer.playbackState() e a flag interna _is_paused.
- Mantida compatibilidade com os fluxos existentes de gera√ß√£o de √°udio e limpeza de arquivos tempor√°rios.

_________________________________________________

NOTAS DE LAN√áAMENTO ‚Äî L√∫men
Vers√£o: 2025.11.26.0
Data: 26 de novembro de 2025
Autor: Fernando Nillsson Cidade

Resumo do lan√ßamento
- Vers√£o inicial alfa/experimental do projeto L√∫men. Ferramenta desktop para apoiar jovens e adultos neurodivergentes (TEA, TDAH, Dislexia) em leitura, organiza√ß√£o e revis√£o ativa do estudo. Substitui refer√™ncias a projetos anteriores (ex.: Economia APP) e alinha artefatos do pacote (EULA, PRIVACY_POLICY, NOTICES, COPYRIGHT, CLC) ao novo escopo.

Principais funcionalidades inclu√≠das
- Leitor acess√≠vel (TTS) com sele√ß√£o de voz, controle de velocidade e volume; reprodutor de √°udio para textos sintetizados.
- Ajustes tipogr√°ficos persistentes (tamanho e fam√≠lia de fonte) para legibilidade.
- R√©gua de foco (highlight m√≥vel) para facilitar acompanhamento visual linha a linha.
- Matriz de Eisenhower para prioriza√ß√£o de tarefas com salvamento local.
- Temporizador Pomodoro e gerenciador de sess√µes de estudo.
- Ferramentas para cria√ß√£o e revis√£o de mapas mentais e suporte ao M√©todo Feynman.
- Importa√ß√£o/exporta√ß√£o local de dados: PDF, JSON e formatos de texto.
- Localiza√ß√£o: pt-BR e en-US (arquivos .ts inclu√≠dos; gerar .qm antes do empacotamento).

Arquivos e recursos inclu√≠dos neste pacote
- C√≥digo: pasta source/
- Utilit√°rios: pasta utils/ (logging, caminhos e helpers)
- Assets: pasta assets/ (ABOUT, EULA, NOTICES, COPYRIGHT, CLC, PRIVACY_POLICY, RELEASE)
- Tradu√ß√µes: language/translations/*.ts (pt_BR, en_US) ‚Äî gerar .qm com pyside6-lrelease
- Documenta√ß√£o: assets/ABOUT/*.txt, assets/EULA/*.txt, assets/NOTICES/*.txt, assets/COPYRIGHT/*.txt, assets/CLC/*.txt

Instala√ß√£o (Windows ‚Äî desenvolvimento)
1. Instale Python 3.10+.
2. No PowerShell:
   python -m venv .venv
   .\.venv\Scripts\Activate.ps1
   pip install -r requirements.txt
3. Executar em desenvolvimento:
   python main.py

Empacotamento para distribui√ß√£o (dicas)
- Recomenda-se PyInstaller, Nuitka para gerar execut√°vel Windows. Incluir assets/ e language/translations/ nas 'datas' do .spec.
- Incluir arquivos de licen√ßa e avisos (assets/EULA, assets/NOTICES, assets/COPYRIGHT, assets/CLC, assets/PRIVACY_POLICY).
- Se empacotar bibliotecas PySide6, documente procedimentos de conformidade LGPL conforme assets/NOTICES/NOTICE_pt_BR.txt.
- Garanta que arquivos .qm de tradu√ß√£o estejam presentes no bundle.

Local de armazenamento de dados
- Configura√ß√µes, hist√≥rico, arquivos tempor√°rios e logs s√£o salvos em:
  %LOCALAPPDATA%\TEA_TDAH_Dislexia
- Observa√ß√£o: o armazenamento local √© padr√£o; o aplicativo n√£o envia telemetria automaticamente (ver assets/PRIVACY_POLICY/Privacy_Policy_pt_BR.txt).

Notas t√©cnicas e depend√™ncias
- Depend√™ncia principal: PySide6 (LGPL v3 conforme vers√£o).
- Verifique requirements.txt para depend√™ncias adicionais.
- Logging: utils/LogManager.py (logs em %LOCALAPPDATA%\TEA_TDAH_Dislexia).
- Testes: vers√£o atual com testes manuais; recomenda‚Äëse adicionar testes unit√°rios para leitura/TTS, exporta√ß√£o e gerenciamento de tarefas.

Problemas conhecidos (vers√£o atual)
- Algumas telas e fluxos UI ainda possuem stubs a completar (source/ui, source/services).
- Tradu√ß√µes requerem compila√ß√£o (.qm) antes do empacotamento.
- Valida√ß√£o de entradas requer refor√ßo (campos vazios, separador decimal, limites negativos).

Roadmap / pr√≥ximos passos
- Completar e testar todos os m√≥dulos UI e servi√ßos com cobertura de testes automatizados.
- Melhorar exporta√ß√£o PDF e layout de relat√≥rios.
- Automatizar processo de build e gera√ß√£o de instalador Windows.
- Implementar telemetria opt‚Äëin para diagn√≥stico (apenas com consentimento expl√≠cito).
- Revisar e atualizar documenta√ß√£o de licen√ßas e notices quando componentes adicionais forem inclu√≠dos.

Suporte e contato
- Autor: Fernando Nillsson Cidade
- Bugs, issues e contribui√ß√µes: abrir issue / pull request no reposit√≥rio do projeto (ver README).
- E‚Äëmail para privacidade e solicita√ß√µes relacionadas a licen√ßas: linceu_lighthouse@outlook.com

Notas de conformidade legal
- Consulte os arquivos inclusos em assets/ para termos completos:
  - EULA: assets/EULA/EULA_pt_BR.txt
  - Pol√≠tica de Privacidade: assets/PRIVACY_POLICY/Privacy_Policy_pt_BR.txt
  - Notices / Licen√ßas de terceiros: assets/NOTICES/NOTICE_pt_BR.txt
  - Copyright / Marca: assets/COPYRIGHT/AVISO DE COPYRIGHT E MARCA REGISTRA_pt_BR.txt
  - Contrato comercial: assets/CLC/CLC_pt_BR.txt
