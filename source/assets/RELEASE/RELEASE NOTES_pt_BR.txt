NOTAS DE LAN√áAMENTO ‚Äî L√∫men
Vers√£o: 2025.12.19.0
Data: 19 de dezembro de 2025
Autor: Fernando Nillsson Cidade

Resumo r√°pido
- Corre√ß√£o no fluxo do bot√£o "ü§ñ Reorganizar com IA": ao reorganizar, o mapa n√£o √© mais "destru√≠do" quando a estrutura foi importada de documento (ex.: PDF); a hierarquia existente √© preservada.
- Amplia√ß√£o da paleta de cores por n√≠vel (cores_nivel) com grada√ß√£o sem√¢ntica (tronco/galhos/folhas) e fallback autom√°tico por HSV para suportar profundidade ilimitada de subn√≠veis sem erro de √≠ndice.
- Consolida√ß√£o do pipeline de importa√ß√£o de documentos e gera√ß√£o de mapa hier√°rquico com enriquecimento informacional (resumos, conceitos, ideias), layout recursivo e navega√ß√£o hier√°rquica.

Detalhamento das mudan√ßas

üó∫Ô∏è Mapa Mental (source/modules/mapa/mp_03_MapaMental.py)

1) Reorganiza√ß√£o com IA ‚Äî preserva√ß√£o da hierarquia existente
- M√©todo alterado: reorganizar_com_ia
  - Detecta quando j√° existe hierarquia ativa (_hierarquia_root e _hierarquia_children).
  - Para mapas gerados por importa√ß√£o (PDF, DOCX), converte a hierarquia baseada em objetos NoConceito para uma hierarquia por √≠ndices (raiz/filhos/niveis) e reaplica somente o layout em √°rvore via _aplicar_layout_arvore(...).
  - Atualiza visibilidade das conex√µes (_atualizar_visibilidade_linhas()) e mant√©m o foco visual no n√≥ raiz (animate_focus_on) quando presente.
  - Evita reconfigurar a hierarquia por √≠ndices nesse caminho para prevenir oculta√ß√£o indevida de n√≥s.

2) Cores por n√≠veis hier√°rquicos ‚Äî suporte a muitos subn√≠veis
- M√©todo alterado: _gerar_mapa_de_hierarquia
  - Mantida e organizada a paleta cores_nivel para representar tronco ‚Üí galhos ‚Üí ramos ‚Üí folhas.
  - Implementado fallback: para n√≠veis al√©m da paleta, gera cor procedimentalmente com QColor.fromHsv(...), garantindo cores distintas para profundidades arbitr√°rias.

3) Gera√ß√£o de mapa hier√°rquico a partir de documentos ‚Äî enriquecimento visual e informacional
- M√©todos: importar_documento_ia + _gerar_mapa_de_hierarquia
  - Importa√ß√£o com QProgressDialog mostrando etapas: carregar IA, extrair texto, analisar estrutura, gerar mapa.
  - Gera√ß√£o recursiva de n√≥s com:
    - Escala din√¢mica por profundidade (setScale decrescente).
    - Conex√µes com espessura vari√°vel conforme n√≠vel.
    - Constru√ß√£o e armazenamento de info_associada (resumo, conceitos, ideias, estat√≠sticas, estrutura).
    - Badge informativo nos n√≥s (_badge) quando h√° informa√ß√£o associada.

4) Navega√ß√£o hier√°rquica (expandir/recolher) e visibilidade de conex√µes
- M√©todos: _habilitar_navegacao_hierarquia, _clicar_no_para_expandir_hierarquia, _aplicar_visibilidade_por_foco, _atualizar_visibilidade_linhas, _instalar_handlers_nos
  - Modo de navega√ß√£o hier√°rquica por clique (expandir/recolher).
  - Linhas de conex√£o (LinhaConexao) respeitam visibilidade de n√≥s (linhas ocultas se algum n√≥ estiver oculto).
  - Handlers de clique instalados preservam comportamento original do n√≥ e adicionam regras para modo de conex√£o e navega√ß√£o hier√°rquica.

5) Layout visual e usabilidade do canvas
- Classes/funcionalidades: MapaScene, SmoothGraphicsView
  - Fundo com gradiente, grid visual (linhas leves a cada 40px e linhas fortes a cada 200px).
  - Snap-to-grid via MapaScene.snap(...) aplicado na cria√ß√£o de n√≥s e ap√≥s reorganiza√ß√£o.
  - Zoom suave com limites, pan por arrastar, e anima√ß√£o de foco (animate_focus_on).

ü§ñ Processamento IA (source/modules/mapa/mp_04_ProcessadorIA.py)

1) Pipeline de an√°lise hier√°rquica profunda de documentos
- M√©todo principal: analisar_estrutura(texto)
  - Detec√ß√£o de idioma (pt/en) por heur√≠stica.
  - Extra√ß√£o avan√ßada de se√ß√µes/t√≠tulos (Parte/Cap√≠tulo/Subcap√≠tulos), incluindo robustez a erros de OCR e numera√ß√£o (1.0, 1.1, 1.1.1).
  - Constru√ß√£o de √°rvore hier√°rquica com rela√ß√µes pai-filho e processamento recursivo para extrair:
    - Conceitos sem√¢nticos (entidades, termos t√©cnicos, conceitos).
    - Ideias principais com scoring.
    - Resumos contextuais multin√≠vel.
  - Aplica√ß√£o de TF-IDF global para refinar import√¢ncias de conceitos.
  - Identifica√ß√£o de rela√ß√µes sem√¢nticas por an√°lise de depend√™ncias/contexto.
- O pipeline de an√°lise IA foi modularizado em fun√ß√µes especializadas sob source/modules/mapa/iaprocessador, facilitando manuten√ß√£o e testes.
- O carregamento do modelo spaCy agora suporta m√∫ltiplos m√©todos: import direto, path local, fallback para spacy.blank e modo b√°sico, garantindo funcionamento mesmo em ambientes sem modelos completos.
- O m√©todo _carregar_modelo_nlp implementa detec√ß√£o autom√°tica do idioma e fallback seguro, com logging detalhado de erros e tentativas.
- O m√©todo _construir_arvore_hierarquica foi aprimorado para montar √°rvores hier√°rquicas a partir de se√ß√µes detectadas, preservando rela√ß√µes pai-filho e delimitando corretamente os textos de cada n√≥.
- A extra√ß√£o de conceitos sem√¢nticos (_extrair_conceitos_semanticos) combina entidades nomeadas, noun chunks e an√°lise de substantivos, com heur√≠sticas para ambientes sem parser completo. Limites din√¢micos por n√≠vel garantem relev√¢ncia dos conceitos.
- A extra√ß√£o de conceitos via TF-IDF (_extrair_conceitos_tfidf) utiliza ngrams (1-3), prioriza noun chunks e termos t√©cnicos, e faz fallback para extra√ß√£o sem√¢ntica caso n√£o haja resultados. Contextos relevantes s√£o associados a cada conceito.
- O m√©todo _identificar_relacoes_avancadas detecta rela√ß√µes entre conceitos usando depend√™ncias sint√°ticas (nsubj, dobj, etc.) quando o parser est√° dispon√≠vel, ou por coocorr√™ncia em senten√ßas caso n√£o esteja. Rela√ß√µes s√£o retornadas como triplas (sujeito, verbo, objeto) ou pares gen√©ricos.
- Todos os m√©todos possuem tratamento robusto de exce√ß√µes e logging detalhado via LogManager, facilitando troubleshooting e rastreabilidade.

2) Robustez na extra√ß√£o de texto e pr√©-processamento
- Extra√ß√£o de PDF via pdfplumber com normaliza√ß√£o (unicodedata.normalize) e heur√≠sticas para corre√ß√£o de padr√µes e recomposi√ß√£o de t√≠tulos quebrados.

üéØ Impacto pr√°tico e comportamento esperado
- Maior resili√™ncia na an√°lise de documentos extensos ou com estrutura irregular.
- Resultados mais ricos na extra√ß√£o de conceitos e rela√ß√µes, mesmo em ambientes com recursos reduzidos.
- Modulariza√ß√£o facilita expans√£o futura (novos tipos de an√°lise, integra√ß√£o com outros modelos).
- Logging aprimorado permite identificar rapidamente falhas ou limita√ß√µes do ambiente.

‚úÖ Reorganiza√ß√£o com IA preserva mapas importados
- Ao importar um documento e gerar mapa, "ü§ñ Reorganizar com IA" reposiciona respeitando a hierarquia existente, evitando recalcular uma √°rvore que colapse a visualiza√ß√£o.

üé® Cores para subn√≠veis ilimitados
- N√≠veis al√©m da paleta recebem cor gerada automaticamente (HSV), evitando erros de √≠ndice e mantendo distin√ß√£o visual.

Como testar (passos r√°pidos)

üß™ Teste 1: Preserva√ß√£o do mapa importado ao reorganizar
1. Abrir Mapa Mental.
2. Importar PDF via "üìÑ Importar Documento (IA)".
3. Clicar em "ü§ñ Reorganizar com IA".
4. Verificar que a estrutura n√£o some e a hierarquia importada √© preservada.

üß™ Teste 2: Profundidade alta e cores
1. Importar documento com muitos n√≠veis (ou simular estrutura).
2. Confirmar que n√≠veis al√©m da paleta recebem cores geradas automaticamente e permanecem distingu√≠veis.

Arquivos principais alterados
- source/modules/mapa/mp_03_MapaMental.py
- source/modules/mapa/mp_04_ProcessadorIA.py

Modulariza√ß√£o do c√≥digo
- O c√≥digo foi reorganizado em m√≥dulos menores sem altera√ß√£o nas funcionalidades ou nas regras de neg√≥cio ‚Äî cada rotina foi extra√≠da para arquivos individuais sob:
  - source/modules/mapa/iaprocessador (pia_01_... ‚Üí pia_29_...) ‚Äî carregamento NLP, extra√ß√£o e processamento de documentos, detec√ß√£o de se√ß√µes, extra√ß√£o de conceitos/ideias/resumos, TF‚ÄëIDF e identifica√ß√£o de rela√ß√µes.
  - source/modules/mapa/mapamental (mm_01_... ‚Üí mm_32_...) ‚Äî UI, scene/view, layout em √°rvore, gera√ß√£o de mapa, handlers e integra√ß√£o com ProcessadorIA.
- Objetivo: melhorar legibilidade, testabilidade e manuten√ß√£o; comportamento e l√≥gica permanecem os mesmos.

Notas t√©cnicas e depend√™ncias
- spaCy 3.x (pt_core_news_lg / en_core_web_lg recomendados)
- scikit-learn (TfidfVectorizer)
- PySide6 6.x (QGraphicsScene, QtMultimedia)
- PyMuPDF / pdfplumber para extra√ß√£o de PDF
- python-docx para DOCX

_________________________________________________

NOTAS DE LAN√áAMENTO ‚Äî L√∫men
Vers√£o: 2025.12.13.0
Data: 13 de dezembro de 2025
Autor: Fernando Nillsson Cidade

Resumo r√°pido
- Integra√ß√£o completa entre Mapa Mental e M√©todo Feynman via EventBus: conceitos criados no mapa agora podem ser enviados automaticamente para revis√£o no M√©todo Feynman.
- Novo bot√£o "‚ûï Integrar ao M√©todo Feynman" no di√°logo de edi√ß√£o de conceitos do Mapa Mental, permitindo envio direto de notas e contextos.
- Sistema de badges visuais (üü°) nos n√≥s do Mapa Mental indicando presen√ßa de notas/informa√ß√µes associadas.
- Processamento IA aprimorado (ProcessadorIA) com an√°lise hier√°rquica profunda, extra√ß√£o contextual de conceitos, gera√ß√£o de resumos multin√≠vel e identifica√ß√£o de rela√ß√µes sem√¢nticas.
- Layout em √°rvore otimizado para visualiza√ß√£o hier√°rquica de documentos importados no Mapa Mental, com c√°lculo din√¢mico de larguras e posicionamento recursivo.
- Melhorias na interface do Mapa Mental: grid visual, snap-to-grid, zoom suave, anima√ß√µes de foco, gradientes de fundo e sombras nos n√≥s.
- Suporte completo √† tradu√ß√£o din√¢mica (pt_BR/en_US) em todos os di√°logos, labels e bot√µes dos m√≥dulos Mapa Mental e M√©todo Feynman.
- Reorganiza√ß√£o arquitetural: c√≥digo modularizado em packages (source/modules/mapa, source/modules/feynman, source/gui) para melhor manutenibilidade.
- Corre√ß√µes de bugs relacionados a movimenta√ß√£o de n√≥s, sincroniza√ß√£o de status de tarefas no Gerenciador de Tarefas (Kanban) e aplica√ß√£o de tema din√¢mico.

Detalhamento das mudan√ßas

üìã Integra√ß√£o Mapa Mental ‚Üî M√©todo Feynman

- Arquivo alterado: source/modules/mapa/mp_01_NoConceito.py
  - Adicionado bot√£o "‚ûï Integrar ao M√©todo Feynman" no di√°logo de edi√ß√£o de conceitos (mouseDoubleClickEvent).
  - Integra√ß√£o com EventBus: emite sinal conceito_atualizado com dados {titulo, notas} ao clicar no bot√£o de integra√ß√£o.
  - Badge visual (c√≠rculo amarelo üü°) exibido no topo do n√≥ quando h√° notas ou informa√ß√µes associadas (self._badge).
  - Valida√ß√£o de campos: aviso ao usu√°rio caso t√≠tulo ou notas estejam vazios antes de integrar.
  - Mensagem de confirma√ß√£o (QMessageBox.information) ap√≥s integra√ß√£o bem-sucedida.
  - Armazenamento de informa√ß√µes associadas (self.info_associada: list[str]) provenientes da an√°lise IA de documentos.
  - Display de informa√ß√µes associadas em modo somente leitura no di√°logo de edi√ß√£o (QTextEdit read-only).

- Arquivo alterado: source/modules/mod_05_metodo_feynman.py
  - Novo m√©todo receber_conceito_mapa_mental(dados: dict) conectado ao sinal conceito_atualizado do EventBus.
  - L√≥gica de mesclagem inteligente: se o conceito j√° existe, atualiza campo 'revisao'; caso contr√°rio, cria novo conceito com explicacao=notas.
  - Salvamento autom√°tico (salvar_conceitos) e atualiza√ß√£o da lista (atualizar_lista) ap√≥s recep√ß√£o de conceito do Mapa Mental.
  - Logging detalhado de eventos de integra√ß√£o para rastreabilidade.
  - Conex√£o ao EventBus estabelecida no __init__ do MetodoFeynman.

- Arquivo criado: source/utils/EventBus.py
  - Implementa√ß√£o de singleton QObject para comunica√ß√£o desacoplada entre m√≥dulos.
  - Sinal conceito_atualizado = Signal(dict) para transmitir dados de conceitos.
  - Fun√ß√£o auxiliar get_event_bus() para facilitar acesso global √† inst√¢ncia √∫nica.
  - Thread-safe: evita recria√ß√£o de inst√¢ncia ap√≥s inicializa√ß√£o.

üó∫Ô∏è Processamento IA e An√°lise Hier√°rquica

- Arquivo alterado: source/modules/mapa/mp_04_ProcessadorIA.py
  - Novo m√©todo analisar_estrutura(texto) com pipeline completo de an√°lise hier√°rquica:
    1. Detec√ß√£o autom√°tica de idioma (pt/en) via palavras-chave.
    2. Extra√ß√£o de se√ß√µes estruturais (_detectar_secoes_avancado) com suporte a padr√µes PARTE/Parte, CAP√çTULO/Chapter, numera√ß√£o decimal (1.0, 1.1.1).
    3. Constru√ß√£o de √°rvore hier√°rquica recursiva (_construir_arvore_hierarquica) preservando rela√ß√µes pai-filho.
    4. Processamento completo de cada n√≥ (_processar_hierarquia_completa):
       - Extra√ß√£o de conceitos sem√¢nticos via NER (Named Entity Recognition), noun chunks e an√°lise de frequ√™ncia.
       - Extra√ß√£o de ideias principais com scoring baseado em posi√ß√£o, densidade sem√¢ntica, palavras indicadoras e comprimento de senten√ßa.
       - Gera√ß√£o de resumos contextuais multin√≠vel (_gerar_resumo_contextual) com TF-IDF local, diversidade sem√¢ntica e prioriza√ß√£o por posi√ß√£o.
    5. Aplica√ß√£o de TF-IDF global (_aplicar_tfidf_global) para refinar import√¢ncias de conceitos em todo o documento.
    6. Identifica√ß√£o de rela√ß√µes sem√¢nticas (_identificar_relacoes_semanticas) via an√°lise de depend√™ncias sint√°ticas (nsubj, dobj, verb).

  - M√©todo _gerar_resumo_contextual aprimorado:
    - Configura√ß√µes diferenciadas por n√≠vel hier√°rquico (n√∫mero de senten√ßas e max_chars).
    - Scoring sofisticado considerando: posi√ß√£o no texto, TF-IDF local, densidade de substantivos/verbos, overlap com t√≠tulo, palavras-chave de resumo.
    - Deduplica√ß√£o sem√¢ntica: evita senten√ßas com alto overlap de lemmas j√° utilizados.
    - Fallback robusto para textos curtos ou sem estrutura clara.

  - M√©todos auxiliares adicionados:
    - _extrair_conceitos_semanticos: combina NER, noun chunks e an√°lise de frequ√™ncia; retorna conceitos com tipo, import√¢ncia, frequ√™ncia e contextos.
    - _extrair_ideias_principais: extrai senten√ßas-chave com scoring baseado em m√∫ltiplos fatores lingu√≠sticos.
    - _extrair_conceitos_tfidf: alternativa baseada em TF-IDF com ngrams (1-3) e filtragem por noun chunks.
    - _identificar_relacoes_avancadas: constr√≥i triplas (sujeito, verbo, objeto) via an√°lise sint√°tica.
    - _log_estrutura_completa: logging recursivo da √°rvore com s√≠mbolos visuais (üå≥üåøüå±üçÉüåæ) para debug.

  - Ajustes de configura√ß√£o:
    - nlp.max_length aumentado para 2.000.000 caracteres para suportar documentos extensos.
    - Fallback de modelos spaCy: pt_core_news_lg ‚Üí en_core_web_lg ‚Üí pt_core_news_sm.
    - Logging detalhado em cada etapa do pipeline para troubleshooting.

üé® Interface do Mapa Mental

- Arquivo alterado: source/modules/mapa/mp_03_MapaMental.py
  - Nova classe MapaScene(QGraphicsScene) com:
    - M√©todo drawBackground personalizado: gradiente linear (#121212 ‚Üí #1e1e1e) + grid visual (linhas leves a cada 40px, linhas fortes a cada 200px).
    - M√©todo snap(pos) para snap-to-grid configur√°vel (self._snap_enabled).
    - Suporte a paletas din√¢micas (Qt dark/light mode).

  - Nova classe SmoothGraphicsView(QGraphicsView) com:
    - Renderiza√ß√£o antialiased para gr√°ficos suaves.
    - DragMode: ScrollHandDrag para navega√ß√£o por arrastar.
    - Zoom via roda do mouse com limites (-15 a +25 n√≠veis, fator 1.15).
    - M√©todo animate_focus_on(item) para destacar item temporariamente com borda branca pulsante.

  - M√©todo importar_documento_ia redesenhado:
    - QProgressDialog com feedback visual em cada etapa (carregamento modelo, extra√ß√£o, an√°lise, gera√ß√£o).
    - Chamada ao ProcessadorIA.analisar_estrutura para obter hierarquia completa.
    - Gera√ß√£o de mapa via _gerar_mapa_de_hierarquia com layout recursivo.

  - M√©todo _gerar_mapa_de_hierarquia aprimorado:
    - Cores diferenciadas por n√≠vel hier√°rquico (marrom‚Üíverde escuro‚Üíverde m√©dio‚Üíverde claro‚Üíamarelo) para representar tronco, galhos, ramos e folhas.
    - Escala din√¢mica dos n√≥s (decrescente com profundidade: 1.2 ‚Üí 0.5).
    - Conex√µes visuais (LinhaConexao) com espessura vari√°vel (4 ‚Üí 1) conforme n√≠vel.
    - Associa√ß√£o de informa√ß√µes estruturadas (resumo, conceitos, ideias) aos n√≥s via no_principal.info_associada.
    - Cria√ß√£o de sub-n√≥s para conceitos e ideias principais (com emoji e formata√ß√£o visual).
    - Expans√£o autom√°tica da √°rea do canvas (_expandir_area_se_necessario) conforme √°rvore cresce.

  - M√©todo reorganizar_com_ia redesenhado:
    - An√°lise TF-IDF dos conceitos existentes.
    - Constru√ß√£o de hierarquia baseada em conex√µes (_construir_hierarquia).
    - Aplica√ß√£o de layout em √°rvore (_aplicar_layout_arvore) com c√°lculo recursivo de larguras (_calcular_larguras_subarvore) e posicionamento otimizado (_posicionar_no_arvore).
    - Snap-to-grid aplicado a todos os n√≥s ap√≥s reorganiza√ß√£o.

  - Melhorias de UX:
    - Bot√£o "ü§ñ Reorganizar com IA" adiciona reorganiza√ß√£o autom√°tica de mapa existente.
    - Bot√£o "üìÑ Importar Documento (IA)" com suporte a PDF, DOCX, TXT.
    - Di√°logo de cores (QColorDialog) traduzido dinamicamente (Basic colors, Custom colors, OK, Cancel, etc).
    - Instru√ß√µes na label inferior (duplo-clique para editar, arrastar para mover, conectar para criar rela√ß√µes).

  - Corre√ß√µes de bugs:
    - Tema din√¢mico aplicado corretamente ao QGraphicsView e scrollbars.
    - EventFilter captura eventos de mudan√ßa de paleta/esquema de cores (PaletteChange, ColorSchemeChange, ThemeChange).
    - Salvamento/carregamento JSON preserva notas, cor, posi√ß√£o e conex√µes.

üì¶ Gerenciador de Tarefas (Kanban)

- Arquivo alterado: source/modules/tempo/tmp_03_GerenciadorTarefas.py
  - Novo m√©todo _on_rows_moved conectado ao sinal rowsMoved do QListWidget.model() para sincronizar status de tarefas ap√≥s drag-and-drop interno.
  - M√©todo _sincronizar_status_pos_movimento: atualiza status das tarefas (Todo/Doing/Done) ap√≥s movimento dentro da mesma coluna, garantindo persist√™ncia correta.
  - Corre√ß√£o no m√©todo mover_tarefa: agora cicla entre estados (Todo ‚Üí Doing ‚Üí Done ‚Üí Todo) em vez de avan√ßar indefinidamente.
  - M√©todo resetar_contagem_botao expandido com tr√™s escopos:
    - "üîπ Uma tarefa espec√≠fica" (seleciona coluna ‚Üí tarefa).
    - "üìÇ Todas as tarefas de uma coluna" (seleciona coluna).
    - "üåê Todas as tarefas (global)".
  - Valida√ß√£o de campos e exibi√ß√£o de QMessageBox.information quando n√£o h√° tarefas.
  - M√©todo _ajustar_largura_combo para ajustar largura do QComboBox de prioridade dinamicamente conforme conte√∫do.
  - M√©todo atualizar_listas aprimorado: exibe emoji de prioridade (üî¥üü°üü¢) + t√≠tulo + contagem de pomodoros (üçÖ) em cada item.
  - CheckState (Qt.Unchecked) habilitado em todos os itens para suportar sele√ß√£o m√∫ltipla.

‚è±Ô∏è Temporizador Pomodoro

- Arquivo alterado: source/modules/tempo/tmp_02_PomodoroTimer.py
  - Integra√ß√£o com SoundManager.instance() para reprodu√ß√£o de alarmes ao finalizar ciclos.
  - M√©todo _executar_alerta redesenhado:
    - Inicia reprodu√ß√£o em loop (play_looping) ANTES de exibir QMessageBox.
    - Conecta fechamento do di√°logo (finished.connect) para parar som automaticamente.
    - Tratamento de exce√ß√µes robusto com fallback silencioso caso SoundManager falhe.
  - M√©todo finalizar_ciclo aprimorado:
    - Mensagens personalizadas para foco e descanso com contagem de ciclos.
    - Altern√¢ncia autom√°tica entre descanso curto (5min) e longo (15min) a cada 4 ciclos.
    - Sincroniza√ß√£o perfeita entre progress bar, label de status e timer interno.
  - M√©todo atualizar_configuracoes: preserva tempo decorrido ao alterar dura√ß√£o de foco/descanso.
  - M√©todo resetar_ciclo: reseta contador de ciclos e volta ao estado inicial de foco.
  - Aplica√ß√£o de tema din√¢mico (_aplicar_tema_dinamico) para labels de status e tempo.
  - EventFilter captura mudan√ßas de paleta/tema para re-renderizar interface.

üé® Utilit√°rios e Infraestrutura

- Arquivo alterado: source/utils/IconUtils.py
  - Fun√ß√£o get_app_base_path aprimorada:
    - Detec√ß√£o de execu√ß√£o via PyInstaller (sys._MEIPASS).
    - Fallback para execut√°vel standalone (sys.executable).
    - Modo desenvolvimento retorna parent da pasta utils.
  - Fun√ß√£o get_icon_path: busca em m√∫ltiplos caminhos (assets/icones, source/assets/icones, _internal/icones) com suporte a m√∫ltiplas extens√µes (.png, .ico, .svg, .jpg).
  - Logging detalhado (‚úì/‚úó) para troubleshooting de √≠cones.

- Arquivo alterado: source/modules/mod_07_exibir_public.py
  - Fun√ß√£o _tr_multi para fallback de tradu√ß√µes (App ‚Üí InterfaceGrafica ‚Üí fallback manual).
  - Fun√ß√£o _lbl para sele√ß√£o de label pt_BR/en_US baseado em idioma.
  - Tradu√ß√µes din√¢micas aplicadas a todos os bot√µes do SobreDialog (show_history, hide_history, show_details, etc).
  - Integra√ß√£o de notas de vers√£o (RELEASE_NOTES_pt_BR/en_US) com bot√£o expans√≠vel.
  - Redimensionamento proporcional do di√°logo (900x600 pixels base, 1x largura, 1.2x altura).

üèóÔ∏è Arquitetura e Modulariza√ß√£o

- Arquivo criado: source/modules/mapa/__init__.py
  - Exporta NoConceito, LinhaConexao, MapaMental, ProcessadorIA via __all__.
  - Facilita imports (from source.modules.mapa import MapaMental).

- Arquivo alterado: source/__init__.py
  - Lazy loading via __getattr__ para EstudoAcessivel.
  - Reduz tempo de inicializa√ß√£o importando apenas quando necess√°rio.

- Arquivo alterado: source/gui_01_estudo_acessivel.py
  - Configura√ß√£o centralizada de QCoreApplication (OrganizationName, ApplicationName) via CaminhoPersistenteUtils.
  - Carregamento de √≠cone da janela (autismo.ico) via IconUtils com logging detalhado.
  - Integra√ß√£o com GerenciadorTraducao para tradu√ß√µes din√¢micas.

- Arquivo alterado: source/src_01_InicializadorMain.py
  - Fun√ß√£o configurar_windows_app_id para AppUserModelID no Windows (taskbar grouping).
  - Fun√ß√£o configurar_icone_aplicacao com valida√ß√£o de tamanhos dispon√≠veis (availableSizes).
  - Logging detalhado em cada etapa da inicializa√ß√£o (‚úì/‚úó).

Impacto e comportamento esperado

‚úÖ Integra√ß√£o Mapa Mental ‚Üí M√©todo Feynman
- Usu√°rio cria conceito no Mapa Mental e adiciona notas contextuais.
- Ao clicar em "‚ûï Integrar ao M√©todo Feynman", conceito √© enviado automaticamente.
- M√©todo Feynman recebe conceito e atualiza lista; se conceito j√° existe, mescla notas no campo "revis√£o".
- Badge amarelo (üü°) indica visualmente que o n√≥ possui notas/informa√ß√µes.

üìÑ Importa√ß√£o de Documentos com IA
- Usu√°rio importa PDF/DOCX/TXT via bot√£o "üìÑ Importar Documento (IA)".
- ProcessadorIA analisa estrutura hier√°rquica, extrai conceitos, ideias e rela√ß√µes.
- Mapa Mental gerado automaticamente com layout em √°rvore:
  - Cores representam n√≠veis (marrom=documento, verde=cap√≠tulos, amarelo=ideias).
  - N√≥s cont√™m resumos contextuais, conceitos-chave e ideias principais.
  - Conceitos e ideias aparecem como sub-n√≥s conectados.
- Estrutura expans√≠vel e naveg√°vel via zoom/pan suave.

üîÑ Reorganiza√ß√£o Autom√°tica
- Usu√°rio clica em "ü§ñ Reorganizar com IA" em mapa existente.
- Algoritmo analisa conex√µes, constr√≥i hierarquia e aplica layout em √°rvore otimizado.
- Todos os n√≥s s√£o reposicionados automaticamente com snap-to-grid.

‚è±Ô∏è Pomodoro + Tarefas
- Alarme toca imediatamente ao finalizar ciclo e repete at√© fechar janela de alerta.
- Gerenciador de Tarefas sincroniza status ap√≥s drag-and-drop interno.
- Contador de pomodoros reset√°vel por tarefa, coluna ou globalmente.

Como testar (passos r√°pidos)

üß™ Teste 1: Integra√ß√£o Mapa Mental ‚Üí Feynman
1. Abrir m√≥dulo "Mapa Mental".
2. Clicar em "‚ûï Adicionar Conceito" e digitar "Tens√£o de Cisalhamento".
3. Duplo-clicar no n√≥ criado.
4. Adicionar notas no campo "Notas (M√©todo Feynman)": "Tens√£o gerada por for√ßas paralelas..."
5. Clicar em "‚ûï Integrar ao M√©todo Feynman".
6. Confirmar mensagem de sucesso.
7. Abrir m√≥dulo "M√©todo Feynman" e verificar conceito na lista.

üß™ Teste 2: Importa√ß√£o de Documento
1. Abrir m√≥dulo "Mapa Mental".
2. Clicar em "üìÑ Importar Documento (IA)".
3. Selecionar arquivo PDF/DOCX de apostila acad√™mica (ex: Resist√™ncia dos Materiais).
4. Aguardar progresso de an√°lise (pode levar 1-3 minutos).
5. Verificar mapa hier√°rquico gerado com cores diferenciadas.
6. Duplo-clicar em n√≥ de cap√≠tulo e verificar resumo contextual, conceitos e ideias.

üß™ Teste 3: Reorganiza√ß√£o com IA
1. No Mapa Mental existente, adicionar v√°rios conceitos e conex√µes manualmente.
2. Clicar em "ü§ñ Reorganizar com IA".
3. Verificar que n√≥s s√£o reposicionados em layout hier√°rquico otimizado.

üß™ Teste 4: Pomodoro + Tarefas
1. Gerenciador de Tarefas: adicionar tarefa "Estudar Cap 3".
2. Arrastar tarefa entre colunas e verificar persist√™ncia de status.
3. Pomodoro: iniciar ciclo curto (1 min) e aguardar alarme.
4. Verificar que alarme toca imediatamente e repete at√© fechar di√°logo.

Notas t√©cnicas

üîß Depend√™ncias
- spaCy 3.x: modelos pt_core_news_lg ou en_core_web_lg recomendados para an√°lise IA completa.
- scikit-learn: TF-IDF vectorization (TfidfVectorizer).
- PySide6 6.x: Qt for Python com suporte a QGraphicsScene, QMediaPlayer, QtMultimedia.
- PyMuPDF (fitz): extra√ß√£o de texto de PDFs.
- python-docx: extra√ß√£o de texto de arquivos DOCX.

üîß Configura√ß√µes persistidas
- QSettings namespace: "Lumen"/"LumenApp".
- Chaves relevantes:
  - pomodoro/sound_path: caminho da campainha.
  - pomodoro/alarm_interval: intervalo entre repeti√ß√µes do alarme.
  - (demais configura√ß√µes em %LOCALAPPDATA%\TEA_TDAH_Dislexia).

üîß Arquitetura modular
- source/modules/mapa/: NoConceito, LinhaConexao, MapaMental, ProcessadorIA.
- source/modules/feynman/: l√≥gica do M√©todo Feynman (carregar, salvar, atualizar).
- source/modules/tempo/: PomodoroTimer, GerenciadorTarefas, Tarefa.
- source/utils/: EventBus, IconUtils, LogManager, CaminhoPersistenteUtils, GerenciadorBotoesUI, SoundManager.
- source/gui/: setup UI, menubar, tradu√ß√µes, atalhos.

üîß Performance
- nlp.max_length = 2.000.000: suporta documentos de at√© ~400 p√°ginas (m√©dia 5000 chars/p√°gina).
- TF-IDF: max_features=100 para an√°lise global; max_features=50 para resumos locais.
- Snap-to-grid: grid_step=40px; strong grid a cada 200px.
- Cache de √≠cones: get_icon_path faz busca sequencial; considere memoization para produ√ß√£o.

_________________________________________________

NOTAS DE LAN√áAMENTO ‚Äî L√∫men
Vers√£o: 2025.12.2.0
Data: 2 de dezembro de 2025
Autor: Fernando Nillsson Cidade

Resumo r√°pido
- Sistema de alarme do Pomodoro aprimorado: escolha de campainha, preview, persist√™ncia, repeti√ß√£o configur√°vel e reprodu√ß√£o robusta.
- Corre√ß√µes e melhorias na reprodu√ß√£o do alarme: repeti√ß√£o respeita a dura√ß√£o do arquivo + intervalo configurado; alarme toca imediatamente ao fim do ciclo e repete at√© o usu√°rio fechar a janela de alerta.
- Interface de configura√ß√£o de som adicionada ao menu de Configura√ß√µes com visualiza√ß√£o de dura√ß√£o e c√°lculo do tempo total entre repeti√ß√µes.
- Melhoria na confiabilidade da reprodu√ß√£o de som (recria√ß√£o do QSoundEffect) para evitar falhas ap√≥s stop/preview.

Detalhamento das mudan√ßas
- Arquivo alterado: source/utils/SoundManager.py
  - Novo gerenciador de som centralizado (singleton) que exp√µe: instance(), play(), play_repeating(), stop(), preview(), get_duration_for_path(), get_available_sounds(), get_alarm_interval(), set_alarm_interval().
  - Dete√ß√£o de dura√ß√£o de arquivos WAV via m√≥dulo wave do Python (m√©todo _get_wav_duration_ms) para obter dura√ß√£o confi√°vel em ms.
  - L√≥gica de repeti√ß√£o: play_repeating() toca o √°udio, calcula pr√≥ximo acionamento como (dura√ß√£o do √°udio) + (intervalo configurado) e agenda com QTimer.
  - Recria√ß√£o limpa do QSoundEffect em _prepare_effect() antes de cada reprodu√ß√£o para evitar comportamento onde som s√≥ toca uma vez.
  - Persist√™ncia da campainha e do intervalo em QSettings (chaves: "pomodoro/sound_path" e "pomodoro/alarm_interval").
  - M√©todos de preview e stop aprimorados; fallback de dura√ß√£o padr√£o (3000ms) quando n√£o detectada.

- Arquivo alterado: source/gui/gui_23_sound_config_dialog.py
  - Novo di√°logo "üîî Configurar Som do Pomodoro" com:
    - Combobox para sele√ß√£o de campainha (lista de WAVs em assets/sound).
    - Bot√£o ‚ñ∂Ô∏è Tocar para preview.
    - SpinBox para definir intervalo (segundos) entre repeti√ß√µes (0‚Äì60).
    - Exibi√ß√£o da dura√ß√£o do arquivo selecionado e do tempo total at√© a pr√≥xima repeti√ß√£o (dura√ß√£o + intervalo).
  - Ao salvar, grava a campainha e o intervalo nas QSettings via SoundManager.

- Arquivo alterado: source/gui/gui_03_setup_menubar.py
  - Adicionada a√ß√£o "üîî Som..." no menu "‚öôÔ∏è Configura√ß√µes" que abre o di√°logo de configura√ß√£o de som.
  - Atualiza m√≥dulos ap√≥s confirma√ß√£o do di√°logo (chamada a atualizar_modulos quando dispon√≠vel).

- Arquivo alterado: source/modules/tempo/tmp_02_PomodoroTimer.py
  - Integra√ß√£o com SoundManager.instance() para tocar alarmes ao finalizar foco/descanso.
  - M√©todo _executar_alerta exibe QMessageBox e inicia o alarme repetitivo (play_repeating) antes de mostrar a caixa; conecta fechamento da caixa para parar o alarme (stop).
  - Corre√ß√£o para que o som toque imediatamente quando o ciclo termina e continue repetindo at√© o fechamento manual da janela de alerta.
  - Logging e tratamento de exce√ß√µes adicionados.

- Arquivo alterado: source/gui/gui_08_atualizar_menu.py
  - Garantia de que a label/a√ß√£o "üîî Som..." seja atualizada quando o idioma for alterado.

Impacto e comportamento esperado
- Ao terminar um ciclo de foco ou de descanso:
  - A janela de alerta (QMessageBox) aparece imediatamente.
  - O alarme toca imediatamente e repete at√© que o usu√°rio feche a janela.
  - A repeti√ß√£o respeita a dura√ß√£o do arquivo de √°udio: pr√≥ximo toque ocorre somente ap√≥s (dura√ß√£o do √°udio) + (intervalo configurado pelo usu√°rio).
- Escolha de campainha e intervalo s√£o persistidos em configura√ß√µes locais (QSettings).
- Preview permite ouvir a campainha sem ativar repeti√ß√£o.

Como testar (passos r√°pidos)
1. Abrir Aplica√ß√£o e ir em ‚öôÔ∏è Configura√ß√µes ‚Üí üîî Som...
2. Selecionar uma campainha (WAV) e usar ‚ñ∂Ô∏è Tocar para preview.
3. Ajustar "Intervalo entre repeti√ß√µes" (ex.: 5s) e verificar o r√≥tulo "Repeti√ß√£o a cada: X.XX segundos" (dura√ß√£o do arquivo + intervalo).
4. Salvar e executar um Pomodoro curto (ou pular ciclo) at√© que finalizar_ciclo dispare.
5. Confirmar que:
   - O som toca imediatamente com a janela de alerta.
   - O som repete ap√≥s (dura√ß√£o do WAV) + (intervalo configurado).
   - Ao fechar a janela de alerta o som para imediatamente.
6. Repetir para ciclo de descanso; testar altera√ß√£o de campainha entre ciclos.

Notas t√©cnicas
- Implementa√ß√£o utiliza PySide6.QtMultimedia.QSoundEffect para reprodu√ß√£o local (compat√≠vel com WAV). Para medir dura√ß√£o de WAV, usa-se m√≥dulo padr√£o wave do Python (sem depend√™ncias externas).
- Configura√ß√µes persistidas via QSettings namespace "Lumen"/"LumenApp".
- Recomendado ter PySide6 com suporte a multimedia (FFmpeg) no ambiente.
- Caso use arquivos que n√£o sejam WAV, a fun√ß√£o de dura√ß√£o ter√° fallback (3s). Suporte a MP3/OUTROS pode exigir QMediaPlayer ou bibliotecas adicionais.

Arquivos principais alterados
- source/utils/SoundManager.py (novo / modificado)
- source/gui/gui_23_sound_config_dialog.py (novo di√°logo de configura√ß√£o)
- source/gui/gui_03_setup_menubar.py (integra√ß√£o do di√°logo no menu)
- source/modules/tempo/tmp_02_PomodoroTimer.py (integra√ß√£o e controle de alarme)
- source/gui/gui_08_atualizar_menu.py (tradu√ß√µes do menu)

Problemas conhecidos
- Dura√ß√£o exata s√≥ √© calculada para arquivos WAV via wave; outros formatos poder√£o usar fallback. Se desejar suporte completo (MP3, OGG), recomenda-se usar QMediaPlayer para extra√ß√£o de metadados ou bibliotecas externas (pydub, mutagen).
- Arquivos WAV muito grandes podem aumentar o custo de leitura; a rotina √© simples e s√≠ncrona.
- Tradu√ß√µes: strings do di√°logo e labels devem ser recompiladas em .qm (pyside6-lrelease) ap√≥s altera√ß√µes no .ts para surtir efeito.

_________________________________________________

NOTAS DE LAN√áAMENTO ‚Äî L√∫men
Vers√£o: 2025.11.29.0
Data: 29 de novembro de 2025
Autor: Fernando Nillsson Cidade

Resumo r√°pido
- Corre√ß√£o no comportamento do Leitor Acess√≠vel (TTS): ao clicar em "‚è∏Ô∏è Pausar" a reprodu√ß√£o agora permanece pausada e novos chunks gerados permanecem enfileirados, evitando que o leitor avance automaticamente para o pr√≥ximo chunk.

Detalhamento das mudan√ßas
- Arquivo alterado: source/modules/leitor/leitor_acessivel/lta_09_play_generated_audio.py
  - Comportamento de pausa corrigido:
    - Antes: quando o usu√°rio pausava a reprodu√ß√£o, novos arquivos de √°udio (chunks) gerados podiam iniciar automaticamente, fazendo o leitor pular a pausa.
    - Agora: a fun√ß√£o _play_generated_audio verifica explicitamente o estado do player (QMediaPlayer.PausedState) e a flag interna _is_paused. Se o player estiver pausado, novos chunks N√ÉO iniciam automaticamente ‚Äî eles s√£o apenas adicionados √† fila (_generated_queue) para reprodu√ß√£o posterior.
  - Prote√ß√µes adicionais:
    - Preserva√ß√£o de chunks durante troca de voz: se _changing_voice estiver ativo, chunks gerados s√£o descartados de forma segura (tentativa de remo√ß√£o do arquivo) e ignorados.
    - Controle de duplicatas: os caminhos dos arquivos gerados s√£o registrados em _generated_files para evitar reprocessamento duplicado.
    - Verifica√ß√£o de estado de reprodu√ß√£o: n√£o tenta iniciar novo √°udio se j√° estiver em PlayingState; respeita PausedState.
  - Robustez e logging:
    - Tratamento de exce√ß√µes expandido para evitar falhas silenciosas e garantir que leitura_finalizada() seja chamada quando apropriado.
    - Mensagens de log documentam erros ao iniciar reprodu√ß√£o de chunks e falhas na limpeza de arquivos gerados.

Impacto e comportamento esperado
- Usu√°rio pausa a narra√ß√£o com o bot√£o "‚è∏Ô∏è Pausar": playback interrompe; novos chunks gerados pelo mecanismo TTS s√£o enfileirados e N√ÉO come√ßam a tocar at√© que o usu√°rio retome manualmente (‚ñ∂Ô∏è Continuar) ou o player esteja em um estado que permita reprodu√ß√£o autom√°tica.
- Troca de voz durante gera√ß√£o: chunks criados durante a troca de voz s√£o descartados de forma segura para evitar reprodu√ß√£o com voz antiga.

Como testar (passos r√°pidos)
1. Iniciar Leitor Acess√≠vel com uma voz que use gera√ß√£o por chunks (Edge TTS ou similar).
2. Iniciar leitura.
3. Enquanto estiver reproduzindo, clicar em "‚è∏Ô∏è Pausar".
4. Confirmar que a reprodu√ß√£o para e que novos chunks gerados (por exemplo, textos longos) n√£o iniciam automaticamente.
5. Clicar em "‚ñ∂Ô∏è Continuar" e confirmar que a fila √© consumida normalmente e a reprodu√ß√£o prossegue.

Notas t√©cnicas
- A corre√ß√£o foca em _play_generated_audio e interage com QMediaPlayer.playbackState() e a flag interna _is_paused.
- Mantida compatibilidade com os fluxos existentes de gera√ß√£o de √°udio e limpeza de arquivos tempor√°rios.

_________________________________________________

NOTAS DE LAN√áAMENTO ‚Äî L√∫men
Vers√£o: 2025.11.26.0
Data: 26 de novembro de 2025
Autor: Fernando Nillsson Cidade

Resumo do lan√ßamento
- Vers√£o inicial alfa/experimental do projeto L√∫men. Ferramenta desktop para apoiar jovens e adultos neurodivergentes (TEA, TDAH, Dislexia) em leitura, organiza√ß√£o e revis√£o ativa do estudo. Substitui refer√™ncias a projetos anteriores (ex.: Economia APP) e alinha artefatos do pacote (EULA, PRIVACY_POLICY, NOTICES, COPYRIGHT, CLC) ao novo escopo.

Principais funcionalidades inclu√≠das
- Leitor acess√≠vel (TTS) com sele√ß√£o de voz, controle de velocidade e volume; reprodutor de √°udio para textos sintetizados.
- Ajustes tipogr√°ficos persistentes (tamanho e fam√≠lia de fonte) para legibilidade.
- R√©gua de foco (highlight m√≥vel) para facilitar acompanhamento visual linha a linha.
- Matriz de Eisenhower para prioriza√ß√£o de tarefas com salvamento local.
- Temporizador Pomodoro e gerenciador de sess√µes de estudo.
- Ferramentas para cria√ß√£o e revis√£o de mapas mentais e suporte ao M√©todo Feynman.
- Importa√ß√£o/exporta√ß√£o local de dados: PDF, JSON e formatos de texto.
- Localiza√ß√£o: pt-BR e en-US (arquivos .ts inclu√≠dos; gerar .qm antes do empacotamento).

Arquivos e recursos inclu√≠dos neste pacote
- C√≥digo: pasta source/
- Utilit√°rios: pasta utils/ (logging, caminhos e helpers)
- Assets: pasta assets/ (ABOUT, EULA, NOTICES, COPYRIGHT, CLC, PRIVACY_POLICY, RELEASE)
- Tradu√ß√µes: language/translations/*.ts (pt_BR, en_US) ‚Äî gerar .qm com pyside6-lrelease
- Documenta√ß√£o: assets/ABOUT/*.txt, assets/EULA/*.txt, assets/NOTICES/*.txt, assets/COPYRIGHT/*.txt, assets/CLC/*.txt

Instala√ß√£o (Windows ‚Äî desenvolvimento)
1. Instale Python 3.10+.
2. No PowerShell:
   python -m venv .venv
   .\.venv\Scripts\Activate.ps1
   pip install -r requirements.txt
3. Executar em desenvolvimento:
   python main.py

Empacotamento para distribui√ß√£o (dicas)
- Recomenda-se PyInstaller, Nuitka para gerar execut√°vel Windows. Incluir assets/ e language/translations/ nas 'datas' do .spec.
- Incluir arquivos de licen√ßa e avisos (assets/EULA, assets/NOTICES, assets/COPYRIGHT, assets/CLC, assets/PRIVACY_POLICY).
- Se empacotar bibliotecas PySide6, documente procedimentos de conformidade LGPL conforme assets/NOTICES/NOTICE_pt_BR.txt.
- Garanta que arquivos .qm de tradu√ß√£o estejam presentes no bundle.

Local de armazenamento de dados
- Configura√ß√µes, hist√≥rico, arquivos tempor√°rios e logs s√£o salvos em:
  %LOCALAPPDATA%\TEA_TDAH_Dislexia
- Observa√ß√£o: o armazenamento local √© padr√£o; o aplicativo n√£o envia telemetria automaticamente (ver assets/PRIVACY_POLICY/Privacy_Policy_pt_BR.txt).

Notas t√©cnicas e depend√™ncias
- Depend√™ncia principal: PySide6 (LGPL v3 conforme vers√£o).
- Verifique requirements.txt para depend√™ncias adicionais.
- Logging: utils/LogManager.py (logs em %LOCALAPPDATA%\TEA_TDAH_Dislexia).
- Testes: vers√£o atual com testes manuais; recomenda‚Äëse adicionar testes unit√°rios para leitura/TTS, exporta√ß√£o e gerenciamento de tarefas.

Problemas conhecidos (vers√£o atual)
- Algumas telas e fluxos UI ainda possuem stubs a completar (source/ui, source/services).
- Tradu√ß√µes requerem compila√ß√£o (.qm) antes do empacotamento.
- Valida√ß√£o de entradas requer refor√ßo (campos vazios, separador decimal, limites negativos).

Roadmap / pr√≥ximos passos
- Completar e testar todos os m√≥dulos UI e servi√ßos com cobertura de testes automatizados.
- Melhorar exporta√ß√£o PDF e layout de relat√≥rios.
- Automatizar processo de build e gera√ß√£o de instalador Windows.
- Implementar telemetria opt‚Äëin para diagn√≥stico (apenas com consentimento expl√≠cito).
- Revisar e atualizar documenta√ß√£o de licen√ßas e notices quando componentes adicionais forem inclu√≠dos.

Suporte e contato
- Autor: Fernando Nillsson Cidade
- Bugs, issues e contribui√ß√µes: abrir issue / pull request no reposit√≥rio do projeto (ver README).
- E‚Äëmail para privacidade e solicita√ß√µes relacionadas a licen√ßas: linceu_lighthouse@outlook.com

Notas de conformidade legal
- Consulte os arquivos inclusos em assets/ para termos completos:
  - EULA: assets/EULA/EULA_pt_BR.txt
  - Pol√≠tica de Privacidade: assets/PRIVACY_POLICY/Privacy_Policy_pt_BR.txt
  - Notices / Licen√ßas de terceiros: assets/NOTICES/NOTICE_pt_BR.txt
  - Copyright / Marca: assets/COPYRIGHT/AVISO DE COPYRIGHT E MARCA REGISTRA_pt_BR.txt
  - Contrato comercial: assets/CLC/CLC_pt_BR.txt
