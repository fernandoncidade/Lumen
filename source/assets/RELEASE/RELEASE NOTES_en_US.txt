RELEASE NOTES ‚Äî L√∫men
Version: 2025.12.2.0
Date: December 2, 2025
Author: Fernando Nillsson Cidade

Quick summary
- Pomodoro alarm system improved: selectable bell sound, preview, persistence, configurable repetition, and more robust playback.
- Fixes and improvements in alarm playback: repetition respects the audio file duration + configured interval; alarm sounds immediately at cycle end and repeats until the user closes the alert dialog.
- Sound configuration interface added to the Settings menu with duration preview and calculation of total time between repetitions.
- Improved reliability of sound playback (recreating QSoundEffect) to avoid failures after stop/preview.

Detailed changes
- Modified file: source/utils/SoundManager.py
  - New centralized sound manager (singleton) exposing: instance(), play(), play_repeating(), stop(), preview(), get_duration_for_path(), get_available_sounds(), get_alarm_interval(), set_alarm_interval().
  - WAV duration detection using Python's wave module (method _get_wav_duration_ms) to obtain a reliable duration in ms.
  - Repetition logic: play_repeating() plays the audio, computes the next trigger as (audio duration) + (configured interval) and schedules it with QTimer.
  - Clean recreation of QSoundEffect in _prepare_effect() before each playback to avoid the behavior where the sound only plays once.
  - Persistence of selected bell and interval in QSettings (keys: "pomodoro/sound_path" and "pomodoro/alarm_interval").
  - Improved preview and stop methods; default fallback duration (3000ms) when detection fails.

- Modified file: source/gui/gui_23_sound_config_dialog.py
  - New dialog "üîî Configure Pomodoro Sound" with:
    - Combobox to select bell (list of WAVs in assets/sound).
    - ‚ñ∂Ô∏è Play button for preview.
    - SpinBox to set the repetition interval (seconds) between repeats (0‚Äì60).
    - Display of selected file duration and total time until next repetition (duration + interval).
  - On save, stores bell and interval in QSettings via SoundManager.

- Modified file: source/gui/gui_03_setup_menubar.py
  - Added action "üîî Sound..." in the "‚öôÔ∏è Settings" menu to open the sound configuration dialog.
  - Updates modules after dialog confirmation (calls atualizar_modulos when available).

- Modified file: source/modules/tempo/tmp_02_PomodoroTimer.py
  - Integrated with SoundManager.instance() to play alarms when focus/rest periods end.
  - Method _executar_alerta shows a QMessageBox and starts the repeating alarm (play_repeating) before showing the dialog; connects dialog close to stop the alarm.
  - Fix so the sound plays immediately when the cycle ends and continues repeating until the alert dialog is manually closed.
  - Added logging and exception handling.

- Modified file: source/gui/gui_08_atualizar_menu.py
  - Ensures the "üîî Sound..." label/action is updated when the language changes.

Impact and expected behavior
- When a focus or rest cycle ends:
  - The alert dialog (QMessageBox) appears immediately.
  - The alarm plays immediately and repeats until the user closes the dialog.
  - Repetition respects the audio file duration: the next play occurs only after (audio duration) + (user-configured interval).
- Selected bell and interval are persisted in local settings (QSettings).
- Preview allows listening to the bell without enabling repetition.

How to test (quick steps)
1. Open the application and go to ‚öôÔ∏è Settings ‚Üí üîî Sound...
2. Select a bell (WAV) and use ‚ñ∂Ô∏è Play for preview.
3. Adjust "Interval between repetitions" (e.g., 5s) and check the label "Repetition every: X.XX seconds" (file duration + interval).
4. Save and run a short Pomodoro (or skip a cycle) until finalizar_ciclo fires.
5. Confirm that:
   - The sound plays immediately with the alert dialog.
   - The sound repeats after (WAV duration) + (configured interval).
   - Closing the alert dialog stops the sound immediately.
6. Repeat for rest cycle; test changing bell between cycles.

Technical notes
- Implementation uses PySide6.QtMultimedia.QSoundEffect for local playback (WAV-compatible). WAV duration is measured with Python's standard wave module (no external dependencies).
- Settings persisted via QSettings under namespace "Lumen"/"LumenApp".
- Recommended to have PySide6 with multimedia (FFmpeg) support in the environment.
- For non‚ÄëWAV files, duration detection falls back (3s). Full support for MP3/other formats may require QMediaPlayer or additional libraries.

Main files changed
- source/utils/SoundManager.py (new / modified)
- source/gui/gui_23_sound_config_dialog.py (new config dialog)
- source/gui/gui_03_setup_menubar.py (dialog integration in menu)
- source/modules/tempo/tmp_02_PomodoroTimer.py (alarm integration and control)
- source/gui/gui_08_atualizar_menu.py (menu translations)

Known issues
- Exact duration is only calculated for WAV files via wave; other formats may fall back. For full format support (MP3, OGG), consider using QMediaPlayer metadata or external libraries (pydub, mutagen).
- Very large WAV files may increase read cost; the routine is simple and synchronous.
- Translations: dialog strings and labels must be recompiled into .qm (pyside6-lrelease) after .ts changes to take effect.

Support and contact
- Author: Fernando Nillsson Cidade
- Issues/PRs: open in the project repository.

_________________________________________________

RELEASE NOTES ‚Äî L√∫men
Version: 2025.11.29.0
Date: November 29, 2025
Author: Fernando Nillsson Cidade

Quick summary
- Fix in the Accessible Reader (TTS) behavior: when clicking "‚è∏Ô∏è Pause" playback now remains paused and newly generated chunks are kept queued, preventing the reader from automatically advancing to the next chunk.

Detailed changes
- Modified file: source/modules/leitor/leitor_acessivel/lta_09_play_generated_audio.py
  - Pause behavior fixed:
    - Before: when the user paused playback, newly generated audio files (chunks) could start automatically, causing the reader to skip the pause.
    - Now: the _play_generated_audio function explicitly checks the player state (QMediaPlayer.PausedState) and the internal _is_paused flag. If the player is paused, new chunks do NOT start automatically ‚Äî they are only added to the queue (_generated_queue) for later playback.
  - Additional protections:
    - Preservation of chunks during voice change: if _changing_voice is active, generated chunks are safely discarded (attempt to remove the file) and ignored.
    - Duplicate control: generated file paths are recorded in _generated_files to avoid duplicate reprocessing.
    - Playback state check: does not attempt to start new audio if already in PlayingState; respects PausedState.
  - Robustness and logging:
    - Expanded exception handling to avoid silent failures and ensure leitura_finalizada() is called when appropriate.
    - Log messages document errors when starting chunk playback and failures when cleaning up generated files.

Impact and expected behavior
- User pauses narration with the "‚è∏Ô∏è Pause" button: playback stops; newly generated chunks from the TTS mechanism are queued and do NOT start playing until the user manually resumes (‚ñ∂Ô∏è Continue) or the player is in a state that allows automatic playback.
- Voice change during generation: chunks created during a voice change are safely discarded to avoid playback with the old voice.

How to test (quick steps)
1. Start Accessible Reader with a voice that uses chunked generation (Edge TTS or similar).
2. Start reading.
3. While playing, click "‚è∏Ô∏è Pause".
4. Confirm playback stops and that newly generated chunks (e.g., for long texts) do not start automatically.
5. Click "‚ñ∂Ô∏è Continue" and confirm the queue is consumed normally and playback resumes.

Technical notes
- The fix focuses on _play_generated_audio and interacts with QMediaPlayer.playbackState() and the internal _is_paused flag.
- Compatibility with existing audio generation and temporary file cleanup flows is preserved.

_________________________________________________

RELEASE NOTES ‚Äî L√∫men
Version: 2025.11.26.0
Date: November 26, 2025
Author: Fernando Nillsson Cidade

Release summary
- Initial alpha/experimental release of the L√∫men project. Desktop tool to support neurodivergent youth and adults (ASD, ADHD, Dyslexia) in reading, organization and active study review. Replaces references to previous projects (e.g., Economia APP) and aligns package artifacts (EULA, PRIVACY_POLICY, NOTICES, COPYRIGHT, CLC) with the new scope.

Key features included
- Accessible reader (TTS) with voice selection, speed and volume control; audio player for synthesized text.
- Persistent typographic adjustments (font size and family) for readability.
- Focus ruler (movable highlight) to facilitate line‚Äëby‚Äëline visual tracking.
- Eisenhower Matrix for task prioritization with local saving.
- Pomodoro timer and study session manager.
- Tools for creating and reviewing mind maps and support for the Feynman Technique.
- Local data import/export: PDF, JSON and text formats.
- Localization: pt-BR and en-US ( .ts files included; generate .qm before packaging).

Files and resources included in this package
- Code: source/ folder
- Utilities: utils/ folder (logging, paths and helpers)
- Assets: assets/ folder (ABOUT, EULA, NOTICES, COPYRIGHT, CLC, PRIVACY_POLICY, RELEASE)
- Translations: language/translations/*.ts (pt_BR, en_US) ‚Äî generate .qm with pyside6-lrelease
- Documentation: assets/ABOUT/*.txt, assets/EULA/*.txt, assets/NOTICES/*.txt, assets/COPYRIGHT/*.txt, assets/CLC/*.txt

Installation (Windows ‚Äî development)
1. Install Python 3.10+.
2. In PowerShell:
   python -m venv .venv
   .\.venv\Scripts\Activate.ps1
   pip install -r requirements.txt
3. Run in development:
   python main.py

Packaging for distribution (tips)
- PyInstaller, Nuitka is recommended to generate a Windows executable. Include assets/ and language/translations/ in the .spec 'datas'.
- Include license and notice files (assets/EULA, assets/NOTICES, assets/COPYRIGHT, assets/CLC, assets/PRIVACY_POLICY).
- If bundling PySide6 libraries, document LGPL compliance procedures according to assets/NOTICES/NOTICE_pt_BR.txt.
- Ensure .qm translation files are present in the bundle.

Data storage location
- Settings, history, temporary files and logs are saved at:
  %LOCALAPPDATA%\TEA_TDAH_Dislexia
- Note: local storage is the default; the application does not send telemetry automatically (see assets/PRIVACY_POLICY/Privacy_Policy_pt_BR.txt).

Technical notes and dependencies
- Main dependency: PySide6 (LGPL v3 as per version).
- Check requirements.txt for additional dependencies.
- Logging: utils/LogManager.py (logs at %LOCALAPPDATA%\TEA_TDAH_Dislexia).
- Tests: current release uses manual tests; adding unit tests for reading/TTS, export and task management is recommended.

Known issues (current release)
- Some UI screens and flows still contain stubs to complete (source/ui, source/services).
- Translations require compilation (.qm) before packaging.
- Input validation needs strengthening (empty fields, decimal separator, negative limits).

Roadmap / next steps
- Complete and test all UI modules and services with automated test coverage.
- Improve PDF export and report layout.
- Automate build process and Windows installer generation.
- Implement opt‚Äëin telemetry for diagnostics (only with explicit consent).
- Review and update license documentation and notices when additional components are included.

Support and contact
- Author: Fernando Nillsson Cidade
- Bugs, issues and contributions: open an issue / pull request in the project repository (see README).
- Email for privacy and license related requests: linceu_lighthouse@outlook.com

Legal compliance notes
- See the included assets/ files for full terms:
  - EULA: assets/EULA/EULA_pt_BR.txt
  - Privacy Policy: assets/PRIVACY_POLICY/Privacy_Policy_pt_BR.txt
  - Notices / Third‚Äëparty licenses: assets/NOTICES/NOTICE_pt_BR.txt
  - Copyright / Trademark: assets/COPYRIGHT/AVISO DE COPYRIGHT E MARCA REGISTRA_pt_BR.txt
  - Commercial agreement: assets/CLC/CLC_pt_BR.txt
